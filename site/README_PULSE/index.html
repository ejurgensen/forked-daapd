<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Generic - Editorial by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" /> 
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
								<header id="header">
									<a href="index.html" class="logo"><strong>Editorial</strong> by HTML5 UP</a>
									<ul class="icons">
										<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
										<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
										<li><a href="#" class="icon brands fa-snapchat-ghost"><span class="label">Snapchat</span></a></li>
										<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
										<li><a href="#" class="icon brands fa-medium-m"><span class="label">Medium</span></a></li>
									</ul>
								</header>

							<!-- Content -->
								<section>
									<h1 id="1-forked-daapd-and-pulseaudio">1. forked-daapd and Pulseaudio</h1>
<p>You have the choice of runnning Pulseaudio either in system mode or user mode.
For headless servers, i.e. systems without desktop users, system mode is
recommended.</p>
<p>If there is a desktop user logged in most of the time, a setup with network
access via localhost only for daemons is a more appropriate solution, since the
normal user administration (with, e.g., <code>pulseaudio -k</code>) works as advertised.
Also, the user specific configuration for pulseaudio is preserved across
sessions as expected.</p>
<ul>
<li><a href="#system-mode-with-bluetooth-support">System mode</a></li>
<li><a href="#user-mode-with-network-access">User mode</a></li>
</ul>
<h2 id="11-system-mode-with-bluetooth-support">1.1 System Mode with Bluetooth support</h2>
<p>Credit: <a href="http://robpope.co.uk/blog/post/setting-up-forked-daapd-with-bluetooth">Rob Pope</a></p>
<p>This guide was written based on headless Debian Jessie platforms. Most of the
instructions will require that you are root.</p>
<h3 id="111-step-1-setting-up-pulseaudio">1.1.1 Step 1: Setting up Pulseaudio</h3>
<p>If you see a "Connection refused" error when starting forked-daapd, then you
will probably need to setup Pulseaudio to run in system mode [1]. This means
that the Pulseaudio daemon will be started during boot and be available to all
users.</p>
<p>How to start Pulseaudio depends on your distribution, but in many cases you will
need to add a pulseaudio.service file to /etc/systemd/system with the following
content:</p>
<pre><code># systemd service file for Pulseaudio running in system mode
[Unit]
Description=Pulseaudio sound server
Before=sound.target

[Service]
ExecStart=/usr/bin/pulseaudio --system --disallow-exit

[Install]
WantedBy=multi-user.target
</code></pre>

<p>If you want Bluetooth support, you must also configure Pulseaudio to load the
Bluetooth module. First install it (Debian:
<code>apt install pulseaudio-module-bluetooth</code>) and then add the following to
/etc/pulse/system.pa:</p>
<pre><code>#### Enable Bluetooth
.ifexists module-bluetooth-discover.so
load-module module-bluetooth-discover
.endif
</code></pre>

<p>Now you need to make sure that Pulseaudio can communicate with the Bluetooth
daemon through D-Bus. On Raspbian this is already enabled, and you can skip this
step. Otherwise do one of the following:</p>
<ol>
<li>Add the pulse user to the bluetooth group: <code>adduser pulse bluetooth</code></li>
<li>Edit /etc/dbus-1/system.d/bluetooth.conf and change the policy for
\&lt;policy context="default"> to "allow"</li>
</ol>
<p>Phew, almost done with Pulseaudio! Now you should:
1. enable system mode on boot with <code>systemctl enable pulseaudio</code>
2. reboot (or at least restart dbus and pulseaudio)
3. check that the Bluetooth module is loaded with <code>pactl list modules short</code></p>
<h3 id="112-step-2-setting-up-forked-daapd">1.1.2 Step 2: Setting up forked-daapd</h3>
<p>Add the user forked-daapd is running as (typically "daapd") to the
"pulse-access" group:</p>
<pre><code>adduser daapd pulse-access
</code></pre>

<p>Now (re)start forked-daapd.</p>
<h3 id="113-step-3-adding-a-bluetooth-device">1.1.3 Step 3: Adding a Bluetooth device</h3>
<p>To connect with the device, run <code>bluetoothctl</code> and then:</p>
<pre><code>power on
agent on
scan on
**Note MAC address of BT Speaker**
pair [MAC address]
**Type Pin if prompted**
trust [MAC address]
connect [MAC address]
</code></pre>

<p>Now the speaker should appear in forked-daapd. You can also verify that
Pulseaudio has detected the speaker with <code>pactl list sinks short</code>.</p>
<h2 id="12-user-mode-with-network-access">1.2 User Mode with Network Access</h2>
<p>Credit: wolfmanx and <a href="http://billauer.co.il/blog/2014/01/pa-multiple-users/">this blog</a></p>
<h3 id="121-step-1-copy-system-pulseaudio-configuration-to-the-users-home-directory">1.2.1 Step 1: Copy system pulseaudio configuration to the users home directory</h3>
<pre><code>mkdir -p ~/.pulse
cp /etc/pulse/default.pa ~/.pulse/
</code></pre>

<h3 id="122-step-2-enable-tcp-access-from-localhost-only">1.2.2 Step 2: Enable TCP access from localhost only</h3>
<p>Edit the file <code>~/.pulse/default.pa</code> , adding the following line at the end:</p>
<pre><code>load-module module-native-protocol-tcp auth-ip-acl=127.0.0.1
</code></pre>

<h3 id="123-step-3-restart-the-pulseaudio-deamon">1.2.3 Step 3: Restart the pulseaudio deamon</h3>
<pre><code>pulseaudio -k
# OR
pulseaudio -D
</code></pre>

<h3 id="124-step-4-adjust-configuration-file">1.2.4 Step 4: Adjust configuration file</h3>
<p>In the <code>audio</code> section of <code>/etc/forked-daapd.conf</code>, set <code>server</code> to <code>localhost</code>:</p>
<pre><code>server = &quot;localhost&quot;
</code></pre>

<hr />
<p>[1] Note that Pulseaudio will warn against system mode. However, in this use
case it is actually the solution recommended by the <a href="https://lists.freedesktop.org/archives/pulseaudio-discuss/2016-August/026823.html">Pulseaudio folks themselves</a>.</p>
								</section>

						</div>
					</div>

				<!-- Sidebar -->
					<div id="sidebar">
						<div class="inner">

							<!-- Search -->
							
								<section id="search" class="alt">
									<form action="../search.html" method="get">
										<input type="text" name="q" id="mkdocs-search-query" placeholder="Search" />
									</form>
								</section>
							

							<!-- Menu -->
							
								<nav id="menu">
									<header class="major">
										<h2>Menu</h2>
									</header>
									<ul>
									
										
											<li>
												<span class="opener">Home</span>
												<ul>
													
														<li><a href="..#1-forked-daapd">1. forked-daapd</a></li>
														
															<li><a href="..#11-looking-for-help">1.1 Looking for help?</a></li>
														
															<li><a href="..#12-contents">1.2 Contents</a></li>
														
															<li><a href="..#13-getting-started">1.3 Getting started</a></li>
														
															<li><a href="..#14-supported-clients">1.4 Supported clients</a></li>
														
															<li><a href="..#15-web-interface">1.5 Web interface</a></li>
														
															<li><a href="..#16-using-remote">1.6 Using Remote</a></li>
														
															<li><a href="..#17-airplay-devicesspeakers">1.7 AirPlay devices/speakers</a></li>
														
															<li><a href="..#18-chromecast">1.8 Chromecast</a></li>
														
															<li><a href="..#19-local-audio-through-alsa">1.9 Local audio through ALSA</a></li>
														
															<li><a href="..#110-local-audio-bluetooth-and-more-through-pulseaudio">1.10 Local audio, Bluetooth and more through Pulseaudio</a></li>
														
															<li><a href="..#111-mp3-network-streaming-streaming-to-ios">1.11 MP3 network streaming (streaming to iOS)</a></li>
														
															<li><a href="..#112-remote-access">1.12 Remote access</a></li>
														
															<li><a href="..#113-supported-formats">1.13 Supported formats</a></li>
														
															<li><a href="..#114-playlists-and-internet-radio">1.14 Playlists and internet radio</a></li>
														
															<li><a href="..#115-artwork">1.15 Artwork</a></li>
														
															<li><a href="..#116-library">1.16 Library</a></li>
														
															<li><a href="..#117-command-line">1.17 Command line</a></li>
														
															<li><a href="..#118-spotify">1.18 Spotify</a></li>
														
															<li><a href="..#119-lastfm">1.19 LastFM</a></li>
														
															<li><a href="..#120-mpd-clients">1.20 MPD clients</a></li>
														
															<li><a href="..#121-references">1.21 References</a></li>
														
													
														<li><a href="..#2-welcome-to-mkdocs">2. Welcome to MkDocs</a></li>
														
															<li><a href="..#21-commands">2.1 Commands</a></li>
														
															<li><a href="..#22-project-layout">2.2 Project layout</a></li>
														
													
												</ul>
											</li>
										
									
										
											<li>
												<span class="opener">JSON API</span>
												<ul>
													
														<li><a href="../README_JSON_API/#1-forked-daapd-api-endpoint-reference">1. forked-daapd API Endpoint Reference</a></li>
														
															<li><a href="../README_JSON_API/#11-player">1.1 Player</a></li>
														
															<li><a href="../README_JSON_API/#12-outputs-speakers">1.2 Outputs / Speakers</a></li>
														
															<li><a href="../README_JSON_API/#13-queue">1.3 Queue</a></li>
														
															<li><a href="../README_JSON_API/#14-library">1.4 Library</a></li>
														
															<li><a href="../README_JSON_API/#15-search">1.5 Search</a></li>
														
															<li><a href="../README_JSON_API/#16-server-info">1.6 Server info</a></li>
														
															<li><a href="../README_JSON_API/#17-settings">1.7 Settings</a></li>
														
															<li><a href="../README_JSON_API/#18-push-notifications">1.8 Push notifications</a></li>
														
															<li><a href="../README_JSON_API/#19-object-model">1.9 Object model</a></li>
														
													
												</ul>
											</li>
										
									
										
											<li>
												<span class="opener">WEBINTERFACE</span>
												<ul>
													
														<li><a href="../README_PLAYER_WEBINTERFACE/#1-forked-daapd-player-web-interface">1. forked-daapd player web interface</a></li>
														
															<li><a href="../README_PLAYER_WEBINTERFACE/#11-screenshots">1.1 Screenshots</a></li>
														
															<li><a href="../README_PLAYER_WEBINTERFACE/#12-usage">1.2 Usage</a></li>
														
															<li><a href="../README_PLAYER_WEBINTERFACE/#13-build-setup">1.3 Build Setup</a></li>
														
													
												</ul>
											</li>
										
									
										
											<li>
												<span class="opener">SMARTPL</span>
												<ul>
													
														<li><a href="../README_SMARTPL/#1-forked-daapd-smart-playlists">1. forked-daapd smart playlists</a></li>
														
															<li><a href="../README_SMARTPL/#11-syntax">1.1 Syntax</a></li>
														
															<li><a href="../README_SMARTPL/#12-examples">1.2 Examples</a></li>
														
															<li><a href="../README_SMARTPL/#13-date-operand-syntax">1.3 Date operand syntax</a></li>
														
															<li><a href="../README_SMARTPL/#differences-to-mt-daapd-smart-playlists">Differences to mt-daapd smart playlists</a></li>
														
													
												</ul>
											</li>
										
									
										
											<li><a href="..">Audio</a></li>
										
									
									</ul>
								</nav>
							

							<!-- Footer -->
								<footer id="footer">
									<p class="copyright">&copy; Untitled. All rights reserved. Demo Images: <a href="https://unsplash.com">Unsplash</a>. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
								</footer>

						</div>
					</div>

			</div>

		<!-- Scripts -->
			<script src="../assets/js/jquery.min.js"></script>
			<script src="../assets/js/browser.min.js"></script>
			<script src="../assets/js/breakpoints.min.js"></script>
			<script src="../assets/js/util.js"></script>
			<script src="../assets/js/main.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
			<script>hljs.initHighlightingOnLoad();</script>
			<script>var base_url = '..';</script>
				<script src="../search/main.js" defer></script>
	</body>
</html>